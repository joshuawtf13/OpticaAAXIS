<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel de Administración - Óptica ITP</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; }
    .admin-container { max-width: 960px; margin: auto; padding: 20px; }
    .formulario, .promo-list {
      background: #fff; margin-top: 20px; padding: 20px;
      border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .preview-image, .editar-img {
      width: 100px; height: 100px; object-fit: cover; border-radius: 8px;
    }
    .promo-item { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
    .promo-info { flex: 1; }
    .promo-info input, .promo-info select, .promo-info textarea {
      width: 100%; margin: 5px 0; padding: 6px;
    }
    button {
      margin: 4px 4px 0 0; padding: 6px 12px; background: #87CEEB;
      color: white; border: none; border-radius: 5px; cursor: pointer;
    }
    button:hover { background: #4682B4; }
    .alerta {
      background-color: #d4edda; color: #155724;
      border: 1px solid #c3e6cb; padding: 10px 20px;
      border-radius: 5px; margin: 10px auto; font-weight: bold;
      display: none; text-align: center;
      width: fit-content; max-width: 90%;
      animation: fadeInOut 3s ease-in-out;
      position: fixed; top: 20px; left: 50%;
      transform: translateX(-50%); box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 9999;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; } 10% { opacity: 1; }
      90% { opacity: 1; } 100% { opacity: 0; }
    }
  </style>
</head>
<body>

  <header>
    <h1>Panel de Administración</h1>
    <nav><a href="index.html">Regresar a Página Principal</a></nav>
  </header>

  <main>
    <section class="admin-container">
      <h2>Gestión de Contenido</h2>

      <!-- Formulario Productos -->
      <div class="formulario">
        <h3>Subir Producto</h3>
        <input type="file" id="fileProducto" accept="image/*" onchange="subirACloudinaryProducto(this)">
        <img id="previewProducto" class="preview-image" style="display:none;">
        <input type="hidden" id="urlImagenProducto">
        <input type="text" id="descripcionProducto" placeholder="Descripción">
        <input type="number" id="precioProducto" placeholder="Precio">
        <select id="categoriaProducto">
          <option value="caballero">Caballero</option>
          <option value="dama">Dama</option>
          <option value="niños">Niños</option>
          <option value="niñas">Niñas</option>
          <option value="accesorios">Accesorios</option>
        </select>
        <button onclick="subirProducto()">Guardar Producto</button>
        <button onclick="limpiarFormularioProducto()">Limpiar</button>
      </div>

      <!-- Formulario Promociones -->
      <div class="formulario">
        <h3>Subir Promoción</h3>
        <input type="file" id="filePromocion" accept="image/*" onchange="subirACloudinaryPromocion(this)">
        <img id="previewPromocion" class="preview-image" style="display:none;">
        <input type="hidden" id="urlImagenPromocion">
        <textarea id="descripcionPromocion" placeholder="Descripción de la promoción"></textarea>
        <label><strong>Categorías:</strong></label><br>
        <label><input type="checkbox" name="categoriaPromo" value="caballero"> Caballero</label>
        <label><input type="checkbox" name="categoriaPromo" value="dama"> Dama</label>
        <label><input type="checkbox" name="categoriaPromo" value="niños"> Niños</label>
        <label><input type="checkbox" name="categoriaPromo" value="niñas"> Niñas</label>
        <label><input type="checkbox" name="categoriaPromo" value="accesorios"> Accesorios</label>
        <br>
        <label>Fecha de vencimiento</label>
        <input type="date" id="vencimientoPromocion">
        <button onclick="subirPromocion()">Guardar Promoción</button>
        <button onclick="limpiarFormularioPromocion()">Limpiar</button>
      </div>

      <!-- Listas -->
      <div class="formulario promo-list">
        <h3>Productos registrados</h3>
        <div id="listaProductos"></div>
      </div>

      <div class="formulario promo-list">
        <h3>Promociones registradas</h3>
        <div id="listaPromociones"></div>
      </div>

    </section>
  </main>

  <div id="alerta" class="alerta"></div>

  <!-- Firebase -->
 <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB11z4COh5adtBgNqar2Gx4JtLfIMB-KIg",
      authDomain: "optica-aaxis.firebaseapp.com",
      databaseURL: "https://optica-aaxis-default-rtdb.firebaseio.com",
      projectId: "optica-aaxis",
      storageBucket: "optica-aaxis.appspot.com",
      messagingSenderId: "796057879313",
      appId: "1:796057879313:web:872dc9b3ce45f0172b82b0"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <script>
    async function subirImagenCloudinary(file) {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", "archivoproductos123");
      const res = await fetch("https://api.cloudinary.com/v1_1/aaxisopt/image/upload", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      return data.secure_url;
    }

    async function subirACloudinaryProducto(input) {
      const url = await subirImagenCloudinary(input.files[0]);
      if (url) {
        document.getElementById("previewProducto").src = url;
        document.getElementById("previewProducto").style.display = "block";
        document.getElementById("urlImagenProducto").value = url;
      }
    }

    async function subirACloudinaryPromocion(input) {
      const url = await subirImagenCloudinary(input.files[0]);
      if (url) {
        document.getElementById("previewPromocion").src = url;
        document.getElementById("previewPromocion").style.display = "block";
        document.getElementById("urlImagenPromocion").value = url;
      }
    }

    async function subirProducto() {
      const descripcion = document.getElementById("descripcionProducto").value.trim();
      const precio = document.getElementById("precioProducto").value.trim();
      const categoria = document.getElementById("categoriaProducto").value;
      const imagenURL = document.getElementById("urlImagenProducto").value;
      if (!descripcion || !precio || !imagenURL) return alert("Completa todos los campos");

      const producto = { descripcion, precio: Number(precio), categoria, imagen: imagenURL };
      await db.ref(`productos/${categoria}`).push(producto);
      mostrarAlerta("Producto guardado");
      limpiarFormularioProducto();
      mostrarProductos();
    }

    async function subirPromocion() {
      const descripcion = document.getElementById("descripcionPromocion").value.trim();
      const vencimiento = document.getElementById("vencimientoPromocion").value;
      const imagen = document.getElementById("urlImagenPromocion").value;
      const categorias = Array.from(document.querySelectorAll("input[name='categoriaPromo']:checked")).map(c => c.value);
      if (!descripcion || !vencimiento || !imagen) return alert("Faltan campos");

      const promo = { descripcion, vencimiento, imagen, categorias, productos: [] };
      await db.ref("promociones").push(promo);
      mostrarAlerta("Promoción guardada");
      limpiarFormularioPromocion();
      mostrarPromociones();
    }

    function mostrarProductos() {
      const cont = document.getElementById("listaProductos");
      cont.innerHTML = "";
      ["caballero", "dama", "niños", "niñas", "accesorios"].forEach(cat => {
        db.ref(`productos/${cat}`).once("value").then(snap => {
          const productos = snap.val();
          if (productos) {
            Object.entries(productos).forEach(([id, p]) => {
              const div = document.createElement("div");
              div.className = "promo-item";
              div.innerHTML = `
                <img src="${p.imagen}" class="editar-img">
                <div class="promo-info">
                  <input value="${p.descripcion}" onchange="actualizarCampoProducto('${cat}', '${id}', 'descripcion', this.value)">
                  <input value="${p.precio}" onchange="actualizarCampoProducto('${cat}', '${id}', 'precio', this.value)">
                  <button onclick="eliminarProducto('${cat}', '${id}')">Eliminar</button>
                </div>
              `;
              cont.appendChild(div);
            });
          }
        });
      });
    }

    function mostrarPromociones() {
      const cont = document.getElementById("listaPromociones");
      cont.innerHTML = "";
      db.ref("promociones").once("value").then(snap => {
        const promos = snap.val();
        if (promos) {
          Object.entries(promos).forEach(([id, promo]) => {
            const div = document.createElement("div");
            div.className = "promo-item";
            div.innerHTML = `
              <img src="${promo.imagen}" class="editar-img">
              <div class="promo-info">
                <textarea onchange="actualizarCampoPromocion('${id}', 'descripcion', this.value)">${promo.descripcion}</textarea>
                <input type="date" value="${promo.vencimiento}" onchange="actualizarCampoPromocion('${id}', 'vencimiento', this.value)">
                <button onclick="eliminarPromocion('${id}')">Eliminar</button>
              </div>
            `;
            cont.appendChild(div);
          });
        }
      });
    }

    function actualizarCampoProducto(cat, id, campo, valor) {
      db.ref(`productos/${cat}/${id}/${campo}`).set(valor);
      mostrarAlerta("Producto actualizado");
    }

    function actualizarCampoPromocion(id, campo, valor) {
      db.ref(`promociones/${id}/${campo}`).set(valor);
      mostrarAlerta("Promoción actualizada");
    }

    function eliminarProducto(cat, id) {
      db.ref(`productos/${cat}/${id}`).remove().then(mostrarProductos);
      mostrarAlerta("Producto eliminado");
    }

    function eliminarPromocion(id) {
      db.ref(`promociones/${id}`).remove().then(mostrarPromociones);
      mostrarAlerta("Promoción eliminada");
    }

    function mostrarAlerta(msg) {
      const alerta = document.getElementById("alerta");
      alerta.textContent = msg;
      alerta.style.display = "block";
      setTimeout(() => alerta.style.display = "none", 3000);
    }

    function limpiarFormularioProducto() {
      document.getElementById("fileProducto").value = "";
      document.getElementById("descripcionProducto").value = "";
      document.getElementById("precioProducto").value = "";
      document.getElementById("categoriaProducto").selectedIndex = 0;
      document.getElementById("urlImagenProducto").value = "";
      document.getElementById("previewProducto").style.display = "none";
    }

    function limpiarFormularioPromocion() {
      document.getElementById("filePromocion").value = "";
      document.getElementById("descripcionPromocion").value = "";
      document.getElementById("vencimientoPromocion").value = "";
      document.getElementById("urlImagenPromocion").value = "";
      document.getElementById("previewPromocion").style.display = "none";
      document.querySelectorAll("input[name='categoriaPromo']").forEach(cb => cb.checked = false);
    }

    window.onload = () => {
      mostrarProductos();
      mostrarPromociones();
    };
  </script>
</body>
</html>

